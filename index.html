<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AR + Three.js split</title>

<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

<style>
    body {
        margin: 0;
        font-family: sans-serif;
        background: #111;
    }

    /* === PARTIE HAUTE (AR) === */
    #top-section {
        height: 120px;
        background: rgba(0,0,0,0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 20px;
    }

    #top-section h1 {
        color: white;
        font-size: 16px;
        margin: 0;
    }

    model-viewer {
        width: 120px;
        height: 60px;
    }

    /* === PARTIE BASSE (3D) === */
    #bottom-section {
        height: calc(100vh - 120px);
        position: relative;
        overflow: hidden;
    }

    canvas {
        display: block;
    }

    #viewLabel {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 22px;
        background: rgba(0,0,0,0.5);
        padding: 10px;
        border-radius: 10px;
        opacity: 0;
        transition: opacity 0.5s;
    }
</style>
</head>

<body>

<!-- === HAUT === -->
<div id="top-section">
    <h1>Voir en AR</h1>
    <model-viewer
        src="dumyRFQ_4webpagetest_centered.glb"
        ar
        ar-modes="webxr scene-viewer quick-look"
        camera-controls
        auto-rotate>
    </model-viewer>
</div>

<!-- === BAS === -->
<div id="bottom-section">
    <div id="viewLabel"></div>
</div>

<!-- THREE -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128/examples/js/controls/OrbitControls.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128/examples/js/loaders/GLTFLoader.js"></script>

<script>
const container = document.getElementById("bottom-section");

/* SCENE */
const scene = new THREE.Scene();

const camera = new THREE.PerspectiveCamera(
    75,
    container.clientWidth / container.clientHeight,
    1,
    20000
);
camera.position.set(100,100,7000);

const renderer = new THREE.WebGLRenderer({ antialias:true });
renderer.setSize(container.clientWidth, container.clientHeight);
container.appendChild(renderer.domElement);

/* CONTROLS */
const controls = new THREE.OrbitControls(camera, renderer.domElement);

/* LIGHT */
scene.add(new THREE.AmbientLight(0xffffff,1));

/* MODEL */
new THREE.GLTFLoader().load("dumyRFQ_4webpagetest.glb",(gltf)=>{
    scene.add(gltf.scene);
});

/* CAMERA VIEWS */
const views=[
{pos:new THREE.Vector3(900,300,7000),target:new THREE.Vector3(0,0,7000)},
{pos:new THREE.Vector3(-100,-100,0),target:new THREE.Vector3(0,0,7000)}
];

let current=0;

function nextCameraView(){
    current=(current+1)%views.length;
    camera.position.copy(views[current].pos);
    controls.target.copy(views[current].target);
}

/* PC */
window.addEventListener("keydown",(e)=>{
    if(e.code==="Space") nextCameraView();
});

/* MOBILE DOUBLE TAP */
let lastTap=0;
renderer.domElement.addEventListener("touchend",(e)=>{
    const now=performance.now();
    if(now-lastTap<300){
        e.preventDefault();
        nextCameraView();
    }
    lastTap=now;
},{passive:false});

/* LOOP */
function animate(){
    requestAnimationFrame(animate);
    controls.update();
    renderer.render(scene,camera);
}
animate();

/* RESIZE */
window.addEventListener("resize",()=>{
    renderer.setSize(container.clientWidth, container.clientHeight);
    camera.aspect = container.clientWidth / container.clientHeight;
    camera.updateProjectionMatrix();
});
</script>

</body>
</html>
